# üéõÔ∏è Dual-Mode: Dati Reali vs Simulazione Manuale

**Data:** 2025-10-10  
**Commit:** `bf712af`  
**Status:** ‚úÖ **IMPLEMENTATO E TESTABILE**

---

## üéØ **PROBLEMA RISOLTO**

### **Errore Critico:**
- ‚ùå **JSON malformato:** Parentesi graffe duplicate alla fine di `database.json`
- ‚ùå **Build error:** "Cannot parse JSON: Unexpected token '}'"
- ‚úÖ **RISOLTO:** Rimosso `}   }  }  }` duplicato

### **Richiesta Funzionalit√†:**
> "Vorrei rendere duplice modalit√†: possibilit√† di vedere con i dati reali che abbiamo calcolato, oppure una prova con dei dati fasulli inseriti a mano. All'inizio sia sempre sui dati reali, poi se schiaccio e voglio visualizzare invece questi dati inseriti a mano, voglio la possibilit√† di inserire io a mano il dato."

---

## üéõÔ∏è **DUAL-MODE IMPLEMENTATO**

### **Due Modalit√† Disponibili:**

#### **1Ô∏è‚É£ MODALIT√Ä DATI REALI (DEFAULT ‚úÖ)**
- **Priorit√† assoluta:** Legge dispositivi SOM Y1 dal database TAM/SAM/SOM
- **Auto-sync:** Modifiche TAM/SAM/SOM ‚Üí Update automatico Revenue Model
- **Fallback intelligente:** Se som1 = 0 ‚Üí usa 100 unit√†
- **Badge:** `üìä Dati Reali` (verde)

#### **2Ô∏è‚É£ MODALIT√Ä SIMULAZIONE MANUALE**
- **Input personalizzato:** Utente inserisce numero dispositivi a piacere
- **What-if analysis:** Test scenari alternativi senza modificare dati reali
- **Real-time update:** Ogni modifica ricalcola istantaneamente tutti i ricavi
- **Badge:** `‚úèÔ∏è Simulazione` (blu)

---

## üñ•Ô∏è **INTERFACCIA UTENTE**

### **Layout Completo:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üí∞ Preview Ricavi Anno 1                                       [‚ÑπÔ∏è]            ‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ üìä Dati Reali        ‚îÇ  ‚îÇ Reali [====‚óã    ] Manuale   ‚îÇ  ‚îÇ (input)      ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ     ‚Üë Badge dinamico          ‚Üë Toggle switch               ‚Üë Solo in modalit√† ‚îÇ
‚îÇ                                                                simulazione      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **üé® Badge Dinamico (3 stati):**

| Modalit√† | Condizione | Badge | Colore | Descrizione |
|----------|-----------|-------|--------|-------------|
| **Reali** | som1 > 0 | `üìä Dati Reali` | üü¢ Verde | Usa dispositivi da TAM/SAM/SOM |
| **Reali** | som1 = 0 | `‚ö†Ô∏è Fallback` | üü° Giallo | Usa 100 unit√† (dati non disponibili) |
| **Manuale** | Toggle ON | `‚úèÔ∏è Simulazione` | üîµ Blu | Usa input utente |

### **üîÑ Toggle Switch:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Reali  [====‚óã    ]  Manuale  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ‚Üë                    ‚Üë
 Verde               Grigio
(attivo)          (inattivo)
```

**Comportamento:**
- **Default:** Switch a sinistra (Reali) ‚úÖ
- **Click:** Switch a destra (Manuale)
- **Colore testo:** Attivo = colorato, Inattivo = grigio

### **‚úèÔ∏è Input Manuale:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Dispositivi: [ 250 ] ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Caratteristiche:**
- **Visibilit√†:** Solo in modalit√† Simulazione
- **Type:** Number input
- **Range:** Min 0, no max
- **Update:** Real-time (ogni digitazione)
- **Width:** 24 (circa 100px)

---

## üîÑ **FLUSSO OPERATIVO**

### **Scenario 1: Avvio Applicazione (DEFAULT)**

```
1. Utente apre Revenue Model
   ‚Üí useRealData = true (DEFAULT)
   
2. Sistema legge database
   ‚Üí somDevicesY1 = 3,086 (da TAM/SAM/SOM)
   
3. UI mostra:
   ‚úÖ Badge: "üìä Dati Reali" (verde)
   ‚úÖ Toggle: Sinistra (Reali)
   ‚úÖ Input: Nascosto
   ‚úÖ Dispositivi: 3,086
   ‚úÖ Hardware Revenue: ‚Ç¨138,870,000
```

### **Scenario 2: Modifica TAM/SAM/SOM (Auto-Sync)**

```
1. Utente va a TAM/SAM/SOM ‚Üí Vista Dispositivi
2. Modifica: SOM Y1 da 0.5% ‚Üí 1%
3. Dopo 2s (auto-save):
   ‚Üí somDevicesY1 = 6,172 (raddoppiato)
   
4. Utente torna a Revenue Model:
   ‚úÖ Dispositivi aggiornati: 6,172
   ‚úÖ Hardware Revenue: ‚Ç¨277,740,000
   ‚úÖ Badge: "üìä Dati Reali" (sempre verde)
   
Nessun reload necessario! ‚ú®
```

### **Scenario 3: Switch a Simulazione Manuale**

```
1. Utente click toggle ‚Üí Destra (Manuale)
   ‚Üí useRealData = false
   
2. UI cambia istantaneamente:
   ‚úÖ Badge: "‚úèÔ∏è Simulazione" (blu)
   ‚úÖ Input appare: [ 100 ]
   ‚úÖ Dispositivi: 100 (default manuale)
   
3. Utente digita: 500
   ‚Üí manualDevices = 500
   
4. Calcoli aggiornati in real-time:
   ‚úÖ Hardware Revenue: ‚Ç¨22,500,000
   ‚úÖ MRR: ‚Ç¨200,000
   ‚úÖ ARR: ‚Ç¨2,200,000
```

### **Scenario 4: Ritorno a Dati Reali**

```
1. Utente click toggle ‚Üí Sinistra (Reali)
   ‚Üí useRealData = true
   
2. UI ripristina:
   ‚úÖ Badge: "üìä Dati Reali" (verde)
   ‚úÖ Input nascosto
   ‚úÖ Dispositivi: 6,172 (da TAM/SAM/SOM)
   ‚úÖ Hardware Revenue: ‚Ç¨277,740,000
   
Dati reali sempre preservati! ‚úÖ
```

---

## üß™ **GUIDA TEST COMPLETA**

### **Test 1: Verifica Default su Dati Reali**

**Steps:**
1. Apri http://localhost:3002
2. Vai a tab "üíº Modello Business"
3. Scorri a "Preview Ricavi Anno 1"

**‚úÖ VERIFICA:**
- [ ] Toggle su "Reali" (sinistra)
- [ ] Badge verde "üìä Dati Reali" (se som1 > 0)
- [ ] Input manuale nascosto
- [ ] Dispositivi mostrano numero da TAM/SAM/SOM

### **Test 2: Auto-Sync con TAM/SAM/SOM**

**Steps:**
1. Vai a "üéØ TAM/SAM/SOM"
2. Click "Vista Dispositivi"
3. Modifica SOM Y1: 0.5% ‚Üí 1%
4. Attendi 2 secondi (auto-save)
5. Torna a "üíº Modello Business"

**‚úÖ VERIFICA:**
- [ ] Dispositivi raddoppiati
- [ ] Hardware revenue aggiornato
- [ ] Badge ancora verde "üìä Dati Reali"
- [ ] Tooltip mostra nuovi valori

### **Test 3: Switch a Simulazione**

**Steps:**
1. In "Preview Ricavi Anno 1"
2. Click toggle ‚Üí Sposta a destra
3. Osserva UI

**‚úÖ VERIFICA:**
- [ ] Badge cambia: "‚úèÔ∏è Simulazione" (blu)
- [ ] Input appare: "Dispositivi: [ 100 ]"
- [ ] Toggle su "Manuale" (destra)
- [ ] Calcoli usano 100 unit√†

### **Test 4: Input Manuale Real-Time**

**Steps:**
1. In modalit√† Simulazione
2. Click su input dispositivi
3. Digita: 500
4. Osserva calcoli

**‚úÖ VERIFICA:**
- [ ] Dispositivi: 500
- [ ] Hardware: 500 √ó ‚Ç¨45,000 = ‚Ç¨22,500,000
- [ ] MRR: 400 √ó ‚Ç¨500 = ‚Ç¨200,000
- [ ] ARR: 400 √ó ‚Ç¨5,500 = ‚Ç¨2,200,000
- [ ] Tooltip aggiorna in real-time

### **Test 5: Ritorno a Dati Reali**

**Steps:**
1. Da modalit√† Simulazione (500 dispositivi)
2. Click toggle ‚Üí Sposta a sinistra
3. Osserva UI

**‚úÖ VERIFICA:**
- [ ] Badge: "üìä Dati Reali" (verde)
- [ ] Input nascosto
- [ ] Dispositivi ripristinati da TAM/SAM/SOM
- [ ] Hardware revenue torna a valori reali
- [ ] Input manuale (500) NON salvato

### **Test 6: Fallback Intelligente**

**Steps:**
1. Vai a TAM/SAM/SOM ‚Üí Vista Dispositivi
2. Deseleziona tutte le regioni
3. Attendi 2 secondi
4. Torna a Modello Business

**‚úÖ VERIFICA:**
- [ ] Badge: "‚ö†Ô∏è Fallback" (giallo)
- [ ] Dispositivi: 100 (fallback)
- [ ] Tooltip: "dati non disponibili"
- [ ] Toggle ancora su "Reali"

---

## üíª **IMPLEMENTAZIONE TECNICA**

### **State Management:**

```typescript
// üéõÔ∏è Stati locali componente
const [useRealData, setUseRealData] = useState(true);     // DEFAULT ‚úÖ
const [manualDevices, setManualDevices] = useState(100);  // Input utente

// üìä Logica selezione sorgente
const hasRealData = somDevicesY1 && somDevicesY1 > 0;
const realDataDevices = hasRealData ? somDevicesY1 : 0;

// üî¢ Calcolo dispositivi finali
const UNITS_Y1 = useRealData 
  ? (realDataDevices > 0 ? realDataDevices : 100)  // Real o fallback
  : manualDevices;                                   // Manual
```

### **UI Components:**

```tsx
{/* Toggle Switch */}
<Switch 
  checked={!useRealData}
  onCheckedChange={(checked) => setUseRealData(!checked)}
/>

{/* Input Manuale (condizionale) */}
{!useRealData && (
  <Input 
    type="number"
    value={manualDevices}
    onChange={(e) => {
      const val = parseInt(e.target.value);
      if (!isNaN(val) && val >= 0) {
        setManualDevices(val);
      }
    }}
  />
)}
```

### **Badge Dinamico:**

```tsx
{useRealData ? (
  hasRealData ? (
    <Badge className="bg-green-100 text-green-700">
      <Database className="h-3 w-3 mr-1" />
      Dati Reali
    </Badge>
  ) : (
    <Badge className="bg-yellow-100 text-yellow-700">
      ‚ö†Ô∏è Fallback
    </Badge>
  )
) : (
  <Badge className="bg-blue-100 text-blue-700">
    <Edit3 className="h-3 w-3 mr-1" />
    Simulazione
  </Badge>
)}
```

---

## üìä **ESEMPIO CALCOLI**

### **Modalit√† Dati Reali (som1 = 3,086)**

```
Hardware Revenue:
  = 3,086 √ó ‚Ç¨45,000 = ‚Ç¨138,870,000

Active Devices (80%):
  = 3,086 √ó 0.80 = 2,469

MRR:
  = 2,469 √ó ‚Ç¨500 = ‚Ç¨1,234,500

ARR:
  = 2,469 √ó ‚Ç¨5,500 = ‚Ç¨13,579,500

TOTALE Y1:
  = ‚Ç¨138,870,000 + ‚Ç¨13,579,500
  = ‚Ç¨152,449,500
```

### **Modalit√† Simulazione (input = 500)**

```
Hardware Revenue:
  = 500 √ó ‚Ç¨45,000 = ‚Ç¨22,500,000

Active Devices (80%):
  = 500 √ó 0.80 = 400

MRR:
  = 400 √ó ‚Ç¨500 = ‚Ç¨200,000

ARR:
  = 400 √ó ‚Ç¨5,500 = ‚Ç¨2,200,000

TOTALE Y1:
  = ‚Ç¨22,500,000 + ‚Ç¨2,200,000
  = ‚Ç¨24,700,000
```

---

## üéØ **PRIORIT√Ä RISPETTATA**

‚úÖ **Default SEMPRE su Dati Reali**
- useRealData inizializzato a `true`
- Nessuna persistenza modalit√† manuale
- Ogni reload parte da Dati Reali

‚úÖ **Simulazione solo su richiesta**
- Richiede azione esplicita (toggle)
- Input appare solo in modalit√† manuale
- Badge blu indica chiaramente stato

‚úÖ **Facile ritorno a Reali**
- Un click sul toggle
- Dati reali sempre preservati
- Nessuna perdita informazioni

---

## üöÄ **BENEFICI IMPLEMENTAZIONE**

### **Per l'Utente:**
- ‚úÖ **Chiarezza:** Badge mostra sempre fonte dati
- ‚úÖ **Flessibilit√†:** Test what-if senza perdere dati reali
- ‚úÖ **Controllo:** Switch rapido tra modalit√†
- ‚úÖ **Sicurezza:** Default su dati reali (no confusione)

### **Per il Business:**
- ‚úÖ **Validazione:** Test scenari alternativi
- ‚úÖ **Presentazioni:** Demo con numeri personalizzati
- ‚úÖ **Analisi sensitivity:** Impact dispositivi su ricavi
- ‚úÖ **Planning:** What-if per target vendite

---

## üìù **TOOLTIP AGGIORNATI**

### **Modalit√† Dati Reali (con dati)**
```
üìä Fonte dati dispositivi:

‚úÖ Dati reali dal TAM/SAM/SOM
  ‚Ä¢ Dispositivi Anno 1 (SOM): 3,086
  ‚Ä¢ Calcolati da: TAM ‚Üí SAM ‚Üí SOM
  ‚Ä¢ Regioni attive nel calcolo TAM/SAM/SOM
  
  ‚Ä¢ Conversione SaaS: 2,469 devices (80%)
```

### **Modalit√† Dati Reali (senza dati)**
```
üìä Fonte dati dispositivi:

‚ö†Ô∏è Fallback: 100 unit√† (dati non disponibili)
  Vai a TAM/SAM/SOM ‚Üí Vista Dispositivi 
  per calcolare i dati reali
  
  ‚Ä¢ Conversione SaaS: 80 devices (80%)
```

### **Modalit√† Simulazione**
```
üìä Fonte dati dispositivi:

‚úèÔ∏è Simulazione Manuale
  ‚Ä¢ Dispositivi impostati manualmente: 500
  ‚Ä¢ Usa questa modalit√† per analisi "what-if"
  
  ‚Ä¢ Conversione SaaS: 400 devices (80%)
```

---

## ‚ö° **PERFORMANCE**

- **Real-time update:** Input onChange ‚Üí Calcoli instantanei
- **No API calls:** Modalit√† manuale puramente client-side
- **State locale:** Non persiste nel database
- **Smooth UX:** Nessun lag o delay visibile

---

## üéâ **CONCLUSIONE**

‚úÖ **Errore JSON risolto** ‚Üí Build funzionante  
‚úÖ **Dual-mode implementato** ‚Üí Dati Reali (default) + Simulazione  
‚úÖ **UI intuitiva** ‚Üí Toggle + Badge + Input condizionale  
‚úÖ **Priorit√† rispettata** ‚Üí Default sempre su dati reali  
‚úÖ **Testabile ora** ‚Üí Tutte le funzionalit√† operative  

---

**Pronto per il test!** üöÄ  
**Server:** http://localhost:3002  
**Commit:** `bf712af`
